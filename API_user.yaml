openapi: 3.0.0
info:
  title: DA04部門設備管理システム API
  description: DA04部門内機器管理システムのOpenAPI仕様
  version: 2.1.0
  contact:
    name: 設備管理APIサポート
    email: equip-support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.example.com/v1
    description: 本番サーバー
  - url: https://staging-api.example.com/v1
    description: ステージングサーバー

tags:
  - name: 管理者管理
    description: 管理者アカウント管理
  - name: ファイル入出力
    description: Excelファイルインポート/エクスポート操作
  - name: ユーザー管理
    description: ユーザー認証と権限管理
  - name: 従業員管理
    description: 従業員基本情報管理
  - name: 設備管理
    description: 設備資産の管理操作
  - name: 権限リスト
    description: 設備使用権限リスト管理
  - name: 現場検査
    description: 作業現場検査管理

paths:
  # ==================================================
  # ユーザー管理モジュール
  # ==================================================
  /auth/login:
    post:
      tags:
        - ユーザー管理
      summary: ユーザーログイン
      description: ユーザー名とパスワードでアクセストークンを取得
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserLoginRequest"
      responses:
        "200":
          description: ログイン成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: 認証失敗
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /auth/password/change:
    post:
      tags:
        - ユーザー管理
      summary: パスワード変更
      description: ログインユーザーのパスワードを変更
      operationId: changePassword
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
      responses:
        "200":
          description: パスワード変更成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          description: 無効なリクエスト
        "401":
          description: 認証失敗

  /users:
    get:
      tags:
        - ユーザー管理
      summary: ユーザーリスト取得
      description: システムユーザーのリストを取得（管理者権限必要）
      operationId: getUsers
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - name: role
          in: query
          description: 権限でフィルタリング
          required: false
          schema:
            type: string
            enum: [admin, manager, inspector, viewer]
        - name: department
          in: query
          description: 部門でフィルタリング
          required: false
          schema:
            type: string
        - name: search
          in: query
          description: 検索キーワード（ユーザー名、表示名、メール）
          required: false
          schema:
            type: string
      responses:
        "200":
          description: ユーザーリスト取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"
                  pagination:
                    $ref: "#/components/schemas/Pagination"

    post:
      tags:
        - ユーザー管理
      summary: 新規ユーザー登録
      description: 新規ユーザーを登録（管理者権限必要）
      operationId: createUser
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
      responses:
        "201":
          description: ユーザー登録成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: 無効なリクエスト
        "403":
          description: 権限不足

  /users/{userId}:
    get:
      tags:
        - ユーザー管理
      summary: ユーザー詳細取得
      description: ユーザーIDに基づきユーザー詳細情報を取得
      operationId: getUserById
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: ユーザーID
          schema:
            type: string
      responses:
        "200":
          description: ユーザー詳細取得成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserDetail"
        "404":
          description: ユーザーが存在しません

    put:
      tags:
        - ユーザー管理
      summary: ユーザー情報更新
      description: ユーザー情報を更新（管理者権限必要）
      operationId: updateUser
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
      responses:
        "200":
          description: ユーザー更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "403":
          description: 権限不足
        "404":
          description: ユーザーが存在しません

    delete:
      tags:
        - ユーザー管理
      summary: ユーザー削除
      description: システムからユーザーを削除（管理者権限必要）
      operationId: deleteUser
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: ユーザー削除成功
        "403":
          description: 権限不足
        "404":
          description: ユーザーが存在しません

  # ==================================================
  # 従業員管理モジュール
  # ==================================================
  /employees:
    get:
      tags:
        - 従業員管理
      summary: 従業員リスト取得
      description: 従業員基本情報のリストを取得（管理者権限必要）
      operationId: getEmployees
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - name: department
          in: query
          description: 部門でフィルタリング
          required: false
          schema:
            type: string
            example: "DA04"
        - name: status
          in: query
          description: 在籍状況でフィルタリング
          required: false
          schema:
            type: string
            enum: [active, inactive, transferred, retired]
        - name: search
          in: query
          description: 検索キーワード（社員番号、氏名、メール）
          required: false
          schema:
            type: string
      responses:
        "200":
          description: 従業員リスト取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Employee"
                  pagination:
                    $ref: "#/components/schemas/Pagination"

    post:
      tags:
        - 従業員管理
      summary: 新規従業員登録
      description: 新規従業員情報を登録（管理者権限必要）
      operationId: createEmployee
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateEmployeeRequest"
      responses:
        "201":
          description: 従業員登録成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Employee"
        "400":
          description: 無効なリクエスト
        "403":
          description: 権限不足

  /employees/{employeeId}:
    get:
      tags:
        - 従業員管理
      summary: 従業員詳細取得
      description: 従業員IDに基づき従業員詳細情報を取得
      operationId: getEmployeeById
      security:
        - bearerAuth: []
      parameters:
        - name: employeeId
          in: path
          required: true
          description: 従業員ID
          schema:
            type: string
      responses:
        "200":
          description: 従業員詳細取得成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeeDetail"
        "404":
          description: 従業員が存在しません

    put:
      tags:
        - 従業員管理
      summary: 従業員情報更新
      description: 従業員情報を更新（管理者権限必要）
      operationId: updateEmployee
      security:
        - bearerAuth: []
      parameters:
        - name: employeeId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateEmployeeRequest"
      responses:
        "200":
          description: 従業員更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Employee"
        "403":
          description: 権限不足
        "404":
          description: 従業員が存在しません

    delete:
      tags:
        - 従業員管理
      summary: 従業員削除
      description: システムから従業員情報を削除（管理者権限必要）
      operationId: deleteEmployee
      security:
        - bearerAuth: []
      parameters:
        - name: employeeId
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: 従業員削除成功
        "403":
          description: 権限不足
        "404":
          description: 従業員が存在しません

  /employees/batch:
    post:
      tags:
        - 従業員管理
      summary: 従業員一括登録
      description: 従業員情報を一括登録（管理者権限必要）
      operationId: batchCreateEmployees
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                employees:
                  type: array
                  items:
                    $ref: "#/components/schemas/CreateEmployeeRequest"
      responses:
        "201":
          description: 一括登録成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  successCount:
                    type: integer
                  failedCount:
                    type: integer
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        employeeNumber:
                          type: string
                        error:
                          type: string

  /employees/import:
    post:
      tags:
        - 従業員管理
        - ファイル入出力
      summary: 従業員リストインポート
      description: Excelファイルで従業員リストをインポート（管理者権限必要）
      operationId: importEmployeeList
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Excelファイル（従業員リスト.xlsx）
                overwrite:
                  type: boolean
                  description: 既存データを上書きするか
                  default: false
      responses:
        "200":
          description: ファイルインポート成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  importedCount:
                    type: integer
                    example: 50
                  updatedCount:
                    type: integer
                    example: 10
                  errors:
                    type: array
                    items:
                      type: string

  /employees/export:
    get:
      tags:
        - 従業員管理
        - ファイル入出力
      summary: 従業員リストエクスポート
      description: 従業員リストをExcelファイルでエクスポート
      operationId: exportEmployeeList
      security:
        - bearerAuth: []
      parameters:
        - name: department
          in: query
          description: 部門でフィルタリング
          required: false
          schema:
            type: string
        - name: status
          in: query
          description: 在籍状況でフィルタリング
          required: false
          schema:
            type: string
            enum: [active, inactive, transferred, retired]
      responses:
        "200":
          description: Excelファイルダウンロード
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary

  # ==================================================
  # 管理者管理モジュール
  # ==================================================
  /auth/admin/login:
    post:
      tags:
        - 管理者管理
      summary: 管理者ログイン
      description: 管理者専用ログイン（社員番号またはメールでログイン）
      operationId: loginAdmin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminLoginRequest"
      responses:
        "200":
          description: ログイン成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: 認証失敗

  /auth/admin/password/change:
    post:
      tags:
        - 管理者管理
      summary: 管理者パスワード変更
      description: 管理者のパスワードを変更
      operationId: changeAdminPassword
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
      responses:
        "200":
          description: パスワード変更成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          description: 無効なリクエスト
        "401":
          description: 認証失敗

  /admin/users:
    get:
      tags:
        - 管理者管理
      summary: 管理者リスト取得
      description: 管理者ユーザーのリストを取得（スーパー管理者権限必要）
      operationId: getAdminUsers
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
      responses:
        "200":
          description: 管理者リスト取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/AdminUser"
                  pagination:
                    $ref: "#/components/schemas/Pagination"

    post:
      tags:
        - 管理者管理
      summary: 管理者ユーザー追加
      description: 新規管理者ユーザーを追加（スーパー管理者権限必要）
      operationId: createAdminUser
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAdminUserRequest"
      responses:
        "201":
          description: 管理者ユーザー追加成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminUser"
        "400":
          description: 無効なリクエスト
        "403":
          description: 権限不足

  /admin/users/{userId}/permissions:
    put:
      tags:
        - 管理者管理
      summary: ユーザー権限付与
      description: ユーザーに管理権限を付与（スーパー管理者権限必要）
      operationId: grantUserPermissions
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GrantPermissionsRequest"
      responses:
        "200":
          description: 権限付与成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "403":
          description: 権限不足
        "404":
          description: ユーザーが存在しません

  /admin/users/{userId}:
    delete:
      tags:
        - 管理者管理
      summary: 管理者権限削除
      description: ユーザーから管理者権限を削除（スーパー管理者権限必要）
      operationId: revokeAdminPermissions
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 管理者権限削除成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: 権限不足
        "404":
          description: ユーザーが存在しません

  # ==================================================
  # 設備管理モジュール（既存のエンドポイントを維持）
  # ==================================================
  /devices:
    get:
      tags:
        - 設備管理
      summary: 設備リスト取得
      description: DA04部門の全設備リストを取得
      operationId: getDevices
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - name: department
          in: query
          description: 部門でフィルタリング
          required: false
          schema:
            type: string
            example: "DA04"
        - name: status
          in: query
          description: 設備ステータスでフィルタリング
          required: false
          schema:
            type: string
            enum: [active, inactive, maintenance, retired]
        - name: search
          in: query
          description: 検索キーワード
          required: false
          schema:
            type: string
      responses:
        "200":
          description: 設備リスト取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Device"
                  pagination:
                    $ref: "#/components/schemas/Pagination"

    post:
      tags:
        - 設備管理
      summary: 新規設備追加
      description: システムに新規設備を追加（管理者権限必要）
      operationId: createDevice
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDeviceRequest"
      responses:
        "201":
          description: 設備追加成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Device"
        "400":
          description: 無効なリクエストデータ
        "403":
          description: 権限不足

  # 既存の設備管理エンドポイントを維持（/devices/{deviceId}など）

  # ==================================================
  # ファイル入出力モジュール
  # ==================================================
  /import/devices:
    post:
      tags:
        - ファイル入出力
      summary: DA04部門設備リストインポート
      description: ExcelファイルでDA04部門設備リストをインポート（管理者権限必要）
      operationId: importDeviceList
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Excelファイル（DA04部門設備リスト.xlsx）
                overwrite:
                  type: boolean
                  description: 既存データを上書きするか
                  default: false
      responses:
        "200":
          description: ファイルインポート成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  importedCount:
                    type: integer
                    example: 50
                  updatedCount:
                    type: integer
                    example: 10
                  errors:
                    type: array
                    items:
                      type: string

  /export/permission-inventory:
    get:
      tags:
        - ファイル入出力
      summary: 設備使用権限リストエクスポート
      description: ISMSFM0502-1設備使用権限リストExcelファイルをエクスポート
      operationId: exportPermissionInventory
      security:
        - bearerAuth: []
      parameters:
        - name: template
          in: query
          description: テンプレートファイルをダウンロードするか
          required: false
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Excelファイルダウンロード
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary

  /export/spot-check:
    get:
      tags:
        - ファイル入出力
      summary: 日常レビュー作業現場検査表エクスポート
      description: ISMSFM1601-1日常レビュー作業現場検査表をエクスポート
      operationId: exportSpotCheck
      security:
        - bearerAuth: []
      parameters:
        - name: month
          in: query
          description: 検査月 (YYYY-MM)
          required: true
          schema:
            type: string
        - name: template
          in: query
          description: テンプレートファイルをダウンロードするか
          required: false
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Excelファイルダウンロード
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary

components:
  schemas:
    # ==================================================
    # 従業員管理スキーマ
    # ==================================================
    Employee:
      type: object
      properties:
        id:
          type: string
          example: "emp_001"
        employeeNumber:
          type: string
          description: 社員番号
          example: "DA04001"
        lastName:
          type: string
          description: 姓
          example: "山田"
        firstName:
          type: string
          description: 名
          example: "太郎"
        lastNameKana:
          type: string
          description: 姓（カナ）
          example: "ヤマダ"
        firstNameKana:
          type: string
          description: 名（カナ）
          example: "タロウ"
        email:
          type: string
          format: email
          description: メールアドレス
          example: "yamada.taro@example.com"
        department:
          type: string
          description: 所属部門
          example: "DA04"
        position:
          type: string
          description: 役職
          example: "主任"
        joinDate:
          type: string
          format: date
          description: 入社日
          example: "2020-04-01"
        status:
          type: string
          enum: [active, inactive, transferred, retired]
          description: 在籍状況
          default: "active"
        phoneNumber:
          type: string
          description: 電話番号
          example: "03-1234-5678"
        extensionNumber:
          type: string
          description: 内線番号
          example: "1234"
        location:
          type: string
          description: 勤務地
          example: "本社ビル 3F"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    EmployeeDetail:
      allOf:
        - $ref: "#/components/schemas/Employee"
        - type: object
          properties:
            assignedDevices:
              type: array
              items:
                $ref: "#/components/schemas/Device"
              description: 割当て済み設備
            userAccount:
              $ref: "#/components/schemas/User"
              description: 関連ユーザーアカウント
            emergencyContact:
              type: object
              description: 緊急連絡先
              properties:
                name:
                  type: string
                relationship:
                  type: string
                phoneNumber:
                  type: string
            address:
              type: object
              description: 住所情報
              properties:
                postalCode:
                  type: string
                address:
                  type: string
            notes:
              type: string
              description: 備考"

    CreateEmployeeRequest:
      type: object
      required:
        - employeeNumber
        - lastName
        - firstName
        - department
        - position
        - joinDate
      properties:
        employeeNumber:
          type: string
          description: 社員番号
          example: "DA04001"
        lastName:
          type: string
          description: 姓
          example: "山田"
        firstName:
          type: string
          description: 名
          example: "太郎"
        lastNameKana:
          type: string
          description: 姓（カナ）
          example: "ヤマダ"
        firstNameKana:
          type: string
          description: 名（カナ）
          example: "タロウ"
        email:
          type: string
          format: email
          description: メールアドレス
          example: "yamada.taro@example.com"
        department:
          type: string
          description: 所属部門
          example: "DA04"
        position:
          type: string
          description: 役職
          example: "主任"
        joinDate:
          type: string
          format: date
          description: 入社日
          example: "2020-04-01"
        phoneNumber:
          type: string
          description: 電話番号
          example: "03-1234-5678"
        extensionNumber:
          type: string
          description: 内線番号
          example: "1234"
        location:
          type: string
          description: 勤務地
          example: "本社ビル 3F"
        emergencyContact:
          type: object
          description: 緊急連絡先
          properties:
            name:
              type: string
            relationship:
              type: string
            phoneNumber:
              type: string
        address:
          type: object
          description: 住所情報
          properties:
            postalCode:
              type: string
            address:
              type: string
        notes:
          type: string
          description: 備考

    UpdateEmployeeRequest:
      type: object
      properties:
        lastName:
          type: string
          description: 姓
        firstName:
          type: string
          description: 名
        lastNameKana:
          type: string
          description: 姓（カナ）
        firstNameKana:
          type: string
          description: 名（カナ）
        email:
          type: string
          format: email
          description: メールアドレス
        department:
          type: string
          description: 所属部門
        position:
          type: string
          description: 役職
        status:
          type: string
          enum: [active, inactive, transferred, retired]
          description: 在籍状況
        phoneNumber:
          type: string
          description: 電話番号
        extensionNumber:
          type: string
          description: 内線番号
        location:
          type: string
          description: 勤務地
        emergencyContact:
          type: object
          description: 緊急連絡先
        address:
          type: object
          description: 住所情報
        notes:
          type: string
          description: 備考

    # ==================================================
    # ユーザー管理スキーマ
    # ==================================================
    UserLoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          description: ユーザー名
          example: "user001"
        password:
          type: string
          format: password
          description: パスワード
          example: "userpassword"

    ChangePasswordRequest:
      type: object
      required:
        - currentPassword
        - newPassword
        - confirmPassword
      properties:
        currentPassword:
          type: string
          format: password
          description: 現在のパスワード
        newPassword:
          type: string
          format: password
          description: 新しいパスワード
        confirmPassword:
          type: string
          format: password
          description: 新しいパスワード（確認）

    User:
      type: object
      properties:
        id:
          type: string
          example: "usr_001"
        employeeNumber:
          type: string
          description: 社員番号
          example: "DA04001"
        username:
          type: string
          description: ユーザー名
          example: "yamada.taro"
        displayName:
          type: string
          description: 表示名
          example: "山田 太郎"
        email:
          type: string
          format: email
          description: メールアドレス
          example: "yamada.taro@example.com"
        department:
          type: string
          description: 所属部門
          example: "DA04"
        role:
          type: string
          enum: [admin, manager, inspector, viewer]
          description: ユーザーロール
          example: "inspector"
        status:
          type: string
          enum: [active, inactive, suspended]
          description: アカウントステータス
          default: "active"
        lastLogin:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserDetail:
      allOf:
        - $ref: "#/components/schemas/User"
        - type: object
          properties:
            permissions:
              type: array
              items:
                type: string
              description: 権限リスト
            loginHistory:
              type: array
              items:
                type: object
                properties:
                  loginTime:
                    type: string
                    format: date-time
                  ipAddress:
                    type: string
                  userAgent:
                    type: string
            assignedDevices:
              type: array
              items:
                $ref: "#/components/schemas/Device"
              description: 割当て済み設備
            employeeInfo:
              $ref: "#/components/schemas/Employee"
              description: 従業員基本情報

    CreateUserRequest:
      type: object
      required:
        - employeeNumber
        - username
        - displayName
        - email
        - department
        - role
      properties:
        employeeNumber:
          type: string
          description: 社員番号
          example: "DA04001"
        username:
          type: string
          description: ユーザー名
          example: "yamada.taro"
        displayName:
          type: string
          description: 表示名
          example: "山田 太郎"
        email:
          type: string
          format: email
          description: メールアドレス
          example: "yamada.taro@example.com"
        department:
          type: string
          description: 所属部門
          example: "DA04"
        role:
          type: string
          enum: [admin, manager, inspector, viewer]
          description: ユーザーロール
          example: "inspector"
        initialPassword:
          type: string
          format: password
          description: 初期パスワード（省略時は自動生成）
          example: "TempPassword123"

    UpdateUserRequest:
      type: object
      properties:
        displayName:
          type: string
          description: 表示名
        email:
          type: string
          format: email
          description: メールアドレス
        department:
          type: string
          description: 所属部門
        role:
          type: string
          enum: [admin, manager, inspector, viewer]
          description: ユーザーロール
        status:
          type: string
          enum: [active, inactive, suspended]
          description: アカウントステータス

    # ==================================================
    # 管理者管理スキーマ
    # ==================================================
    AdminLoginRequest:
      type: object
      required:
        - loginId
        - password
      properties:
        loginId:
          type: string
          description: 社員番号またはメールアドレス
          example: "DA04ADMIN001 or admin@example.com"
        password:
          type: string
          format: password
          example: "adminpassword"

    AdminUser:
      allOf:
        - $ref: "#/components/schemas/User"
        - type: object
          properties:
            adminLevel:
              type: string
              enum: [super_admin, department_admin, system_admin]
              description: 管理者レベル
            permissions:
              type: array
              items:
                type: string
              description: 管理権限
            isSuperAdmin:
              type: boolean
              description: スーパー管理者かどうか
              default: false

    CreateAdminUserRequest:
      type: object
      required:
        - employeeNumber
        - username
        - displayName
        - email
        - adminLevel
      properties:
        employeeNumber:
          type: string
          description: 社員番号
          example: "DA04ADMIN001"
        username:
          type: string
          description: ユーザー名
          example: "admin.yamada"
        displayName:
          type: string
          description: 表示名
          example: "山田 管理者"
        email:
          type: string
          format: email
          description: メールアドレス
          example: "admin.yamada@example.com"
        department:
          type: string
          description: 所属部門
          example: "DA04"
        adminLevel:
          type: string
          enum: [super_admin, department_admin, system_admin]
          description: 管理者レベル
        permissions:
          type: array
          items:
            type: string
          description: 付与する権限
        initialPassword:
          type: string
          format: password
          description: 初期パスワード

    GrantPermissionsRequest:
      type: object
      required:
        - permissions
      properties:
        permissions:
          type: array
          items:
            type: string
          description: 付与する権限リスト
        adminLevel:
          type: string
          enum: [super_admin, department_admin, system_admin]
          description: 管理者レベル

    # ==================================================
    # 権限リスト管理スキーマ
    # ==================================================
    PermissionInventory:
      type: object
      description: ISMSFM0502-1設備使用権限リスト形式
      properties:
        id:
          type: string
          description: 権限リストID
        deviceNumber:
          type: string
          description: 設備番号
          example: "DA04-PC-001"
        computerName:
          type: string
          description: コンピュータ名
          example: "DA04-PC001"
        ipAddress:
          type: string
          description: IPアドレス
          example: "192.168.1.100"
        user:
          type: string
          description: 使用者
          example: "山田太郎"
        department:
          type: string
          description: 所属部門
          example: "DA04"
        domain:
          type: string
          description: ドメイン
          example: "company.local"
        smartITInstalled:
          type: boolean
          description: SmartITインストール
          example: true
        usbDevice:
          type: string
          description: USBデバイス設定
          enum: [enabled, disabled, read-only]
          example: "disabled"
        antivirus:
          type: string
          description: アンチウイルスソフト
          example: "Symantec Endpoint Protection"
        permissionLevel:
          type: string
          enum: [admin, user, guest]
          description: 権限レベル
          example: "user"
        lastUpdated:
          type: string
          format: date-time
          description: 最終更新日時
        generatedBy:
          type: string
          description: 生成者
          example: "システム管理者"

    # ==================================================
    # 現場検査管理スキーマ
    # ==================================================
    SpotCheck:
      type: object
      description: ISMSFM1601-1現場検査記録形式
      properties:
        checkId:
          type: string
          description: 検査ID
          example: "chk_001"
        deviceNumber:
          type: string
          description: 設備番号
          example: "DA04-PC-001"
        computerName:
          type: string
          description: コンピュータ名
          example: "DA04-PC001"
        user:
          type: string
          description: 使用者
          example: "山田太郎"
        checkMonth:
          type: string
          description: 検査月 (YYYY-MM)
          example: "2024-01"
        powerOnAuth:
          type: string
          description: 起動認証
          enum: [○, ×]
          example: "○"
        screenSaver:
          type: string
          description: パスワードスクリーンセーバー
          enum: [○, ×]
          example: "○"
        passwordPolicy:
          type: string
          description: パスワードポリシー
          enum: [○, ×]
          example: "○"
        fileSharing:
          type: string
          description: ファイル共有設定
          enum: [○, ×]
          example: "×"
        illegalSoftware:
          type: string
          description: 不正ソフトウェア検査
          enum: [○, ×]
          example: "○"
        checkDate:
          type: string
          format: date-time
          description: 検査日時
        checker:
          type: string
          description: 検査者
          example: "検査員 太郎"
        notes:
          type: string
          description: 備考
          example: "問題なし"
        status:
          type: string
          enum: [pending, in_progress, completed]
          description: 検査ステータス
          example: "completed"

    # ==================================================
    # 設備管理スキーマ
    # ==================================================
    Device:
      type: object
      properties:
        id:
          type: string
          example: "dev_001"
        deviceNumber:
          type: string
          description: 設備番号
          example: "DA04-PC-001"
        computerName:
          type: string
          description: コンピュータ名
          example: "DA04-PC001"
        ipAddress:
          type: string
          description: IPアドレス
          example: "192.168.1.100"
        user:
          type: string
          description: 使用者
          example: "山田太郎"
        department:
          type: string
          description: 所属部門
          example: "DA04"
        os:
          type: string
          description: オペレーティングシステム
          example: "Windows 10"
        status:
          type: string
          enum: [active, inactive, maintenance, retired]
          example: "active"
        lastMaintenanceDate:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateDeviceRequest:
      type: object
      required:
        - deviceNumber
        - computerName
        - user
        - department
      properties:
        deviceNumber:
          type: string
          example: "DA04-PC-001"
        computerName:
          type: string
          example: "DA04-PC001"
        ipAddress:
          type: string
          example: "192.168.1.100"
        user:
          type: string
          example: "山田太郎"
        department:
          type: string
          example: "DA04"
        os:
          type: string
          example: "Windows 10"
        domain:
          type: string
          example: "会社ドメイン"
        smartITInstalled:
          type: boolean
          example: true
        usbDevice:
          type: string
          enum: [enabled, disabled, read-only]
          example: "disabled"
        antivirus:
          type: string
          example: "Symantec Endpoint Protection"
        specifications:
          type: object
          properties:
            cpu:
              type: string
            memory:
              type: string
            storage:
              type: string
        location:
          type: string
        notes:
          type: string

    # ==================================================
    # 共通スキーマ
    # ==================================================
    AuthResponse:
      type: object
      properties:
        accessToken:
          type: string
        tokenType:
          type: string
          example: "Bearer"
        expiresIn:
          type: integer
          example: 3600
        user:
          $ref: "#/components/schemas/User"

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
        timestamp:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer
        totalPages:
          type: integer

    Error:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
        details:
          type: string
        timestamp:
          type: string
          format: date-time

  # セキュリティスキーム
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  # パラメータ
  parameters:
    PageParam:
      name: page
      in: query
      description: ページ番号
      required: false
      schema:
        type: integer
        default: 1
        minimum: 1

    LimitParam:
      name: limit
      in: query
      description: ページあたりの件数
      required: false
      schema:
        type: integer
        default: 20
        maximum: 100
        minimum: 1

  # レスポンス
  responses:
    UnauthorizedError:
      description: 認証失敗またはトークン無効
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    ForbiddenError:
      description: 権限不足
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    NotFoundError:
      description: リクエストされたリソースが存在しません
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"