openapi: 3.0.0
info:
  title: DA04部門設備管理システム API
  description: DA04部門内機器管理システムのOpenAPI仕様
  version: 1.1.0
  contact:
    name: 設備管理APIサポート
    email: equip-support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.example.com/v1
    description: 本番サーバー
  - url: https://staging-api.example.com/v1
    description: ステージングサーバー

components:
  schemas:
    UserInfo:
      type: object
      description: ユーザー基本情報
      properties:
        userId:
          type: string
          description: ユーザーID（主キー）
        userName:
          type: string
          description: 氏名
        level:
          type: string
          description: アクセスレベル
        loginName:
          type: string
          description: ログインユーザ名
        jobNumber:
          type: string
          description: 社員番号（ユニークキー）
        deptId:
          type: string
          description: 所属部署番号
        userTypeId:
          type: integer
          format: int64
          description: ユーザータイプID（ディクショナリ項目に関連：USER_TYPE）
        createTime:
          type: string
          format: date-time
          description: 作成時間
        updateTime:
          type: string
          format: date-time
          description: 更新時間
        updater:
          type: string
          description: 更新者
        isDeleted:
          type: integer
          format: int32
          description: 論理削除フラグ（0=未削除、1=削除済） 
    DeviceInfo:
      type: object
      description: 機器基本情報
      properties:
        deviceId:
          type: string
          description: 機器番号（主キー）
        deviceModel:
          type: string
          description: ホスト機種
        computerName:
          type: string
          description: コンピュータ名
        loginUsername:
          type: string
          description: ログインユーザ名
        project:
          type: string
          description: 所属プロジェクト
        devRoom:
          type: string
          description: 所属開発室
        jobNumber:
          type: string
          description: 社員番号（所属ユーザー、外部キー）
        remark:
          type: string
          description: 備考
        selfConfirmId:
          type: integer
          format: int64
          description: 本人確認ID（ディクショナリ項目に関連：CONFIRM_STATUS）
        createTime:
          type: string
          format: date-time
          description: 作成時間
        updateTime:
          type: string
          format: date-time
          description: 更新時間
        updater:
          type: string
          description: 更新者
        osId:
          type: integer
          format: int64
          description: OSタイプID（ディクショナリ項目に関連：OS_TYPE）
        memoryId:
          type: integer
          format: int64
          description: メモリサイズID（ディクショナリ項目に関連：MEMORY_SIZE）
        ssdId:
          type: integer
          format: int64
          description: SSDサイズID（ディクショナリ項目に関連：SSD_SIZE）
        hddId:
          type: integer
          format: int64
          description: HDDサイズID（ディクショナリ項目に関連：HDD_SIZE）
        isDeleted:
          type: integer
          format: int32
          description: 論理削除フラグ（0=未削除、1=削除済）  
    DeviceIp:
      type: object
      description: 機器IP情報
      properties:
        ipId:
          type: string
          description: IP番号（主キー）
        deviceId:
          type: string
          description: 機器番号（外部キー）
        ipAddress:
          type: string
          description: IPアドレス（ユニーク）
        createTime:
          type: string
          format: date-time
          description: 作成時間
        updateTime:
          type: string
          format: date-time
          description: 更新時間
        updater:
          type: string
          description: 更新者
        isDeleted:
          type: integer
          format: int32
          description: 論理削除フラグ（0=未削除、1=削除済）  
    DevicePermission:
      type: object
      description: 機器使用権限情報
      properties:
        permissionId:
          type: string
          description: 権限番号（主キー）
        jobNumber:
          type: string
          description: 社員番号（外部キー）
        domainStatusId:
          type: integer
          format: int64
          description: ドメインステータスID（ディクショナリ項目に関連：DOMAIN_STATUS）
        domainGroup:
          type: string
          description: ドメイン内グループ名
        noDomainReason:
          type: string
          description: ドメイン未加入理由
        smartitStatusId:
          type: integer
          format: int64
          description: SmartITステータスID（ディクショナリ項目に関連：SMARTIT_STATUS）
        noSmartitReason:
          type: string
          description: SmartIT未インストール理由
        usbStatusId:
          type: integer
          format: int64
          description: USBステータスID（ディクショナリ項目に関連：USB_STATUS）
        usbReason:
          type: string
          description: USB使用許可理由
        usbExpireDate:
          type: string
          format: date
          description: USB使用有効期限
        antivirusStatusId:
          type: integer
          format: int64
          description: ウイルス対策ステータスID（ディクショナリ項目に関連：ANTIVIRUS_STATUS）
        noSymantecReason:
          type: string
          description: Symantec未導入理由
        remark:
          type: string
          description: 備考
        createTime:
          type: string
          format: date-time
          description: 作成時間
        updateTime:
          type: string
          format: date-time
          description: 更新時間
        updater:
          type: string
          description: 更新者
        isDeleted:
          type: integer
          format: int32
          description: 論理削除フラグ（0=未削除、1=削除済）  

    dictType:
        type: object
        description: ディクショナリタイプ情報
        properties:
          dictTypeId:
            type: integer
            format: int64
            description: ディクショナリタイプID（主キー）
          dictTypeCode:
            type: string
            description: ディクショナリタイプコード（ユニーク）
          dictTypeName:
            type: string
            description: ディクショナリタイプ名
          description:
            type: string
            description: ディクショナリタイプの説明
          isEnabled:
            type: integer
            format: int32
            description: 有効フラグ（0=無効、1=有効）
          createTime:
            type: string
            format: date-time
            description: 作成時間
          updateTime:
            type: string
            format: date-time
            description: 更新時間
          isDeleted:
            type: integer
            format: int32
            description: 論理削除フラグ（0=未削除、1=削除済）
      
    dictItem:
      type: object
      description: ディクショナリ項目情報
      properties:
        dictItemId:
          type: integer
          format: int64
          description: ディクショナリ項目ID（主キー）
        dictTypeId:
          type: integer
          format: int64
          description: ディクショナリタイプID（外部キー）
        dictItemCode:
          type: string
          description: ディクショナリ項目コード（同一タイプ内ユニーク）
        dictItemName:
          type: string
          description: ディクショナリ項目名
        sort:
          type: integer
          format: int32
          description: ソート番号
        isEnabled:
          type: integer
          format: int32
          description: 有効フラグ（0=無効、1=有効）
        createTime:
          type: string
          format: date-time
          description: 作成時間
        updateTime:
          type: string
          format: date-time
          description: 更新時間
        isDeleted:
          type: integer
          format: int32
          description: 論理削除フラグ（0=未削除、1=削除済）

    CommonResponse:
      type: object
      properties:
        code:
          type: integer
          description: ステータスコード：200は成功、その他はエラー
          example: 200
        message:
          type: string
          description: 通知メッセージ
          example: 操作成功
        data:
          type: object
          description: 業務データ（成功時に返却）

    PageResponse:
      type: object
      properties:
        total:
          type: integer
          description: 総レコード数
          example: 155
        pages:
          type: integer
          description: 総ページ数
          example: 8
        pageNum:
          type: integer
          description: 現在のページ番号
          example: 1
        pageSize:
          type: integer
          description: 1ページあたりの表示件数
          example: 20
        list:
          type: array
          items:
            type: object
            properties:
              userInfo:
                $ref: '#/components/schemas/UserInfo'
              deviceInfo:
                $ref: '#/components/schemas/DeviceInfo'
              deviceIp:
                $ref: '#/components/schemas/DeviceIp'
              devicePermission:
                $ref: '#/components/schemas/DevicePermission'


     # 抜取り点検VO（前端表示用）
    SamplingCheck:
      type: object
      description: 抜取り点検表示データ（前端画面表示用）
      properties:
        samplingId:
          type: string
          description: 抜取り点検番号
        jobNumber:
          type: string
          description: 社員番号
        userName:
          type: string
          description: 氏名
        deviceId:
          type: string
          description: 機器番号
        deviceModel:
          type: string
          description: 機器モデル（device_info.device_modelに関連）
        screenSaverPwdStatus:
          type: string
          description: スクリーンセーバーパスワード状況（ディクショナリ名称：CHECK_RESULT）
        installedSoftware:
          type: string
          description: インストール済ソフトウェア
        disposalMeasures:
          type: string
          description: 処置措置
        usbInterfaceStatus:
          type: string
          description: USBインターフェース状況（ディクショナリ名称：USB_SEAL_STATUS）
        securityPatchStatus:
          type: string
          description: セキュリティパッチ状況（ディクショナリ名称：PATCH_STATUS）
        antivirusProtectionStatus:
          type: string
          description: ウイルス防御状況（ディクショナリ名称：ANTIVIRUS_PROTECTION_STATUS）
        bootAuthenticationStatus:
          type: string
          description: 起動認証状況（ディクショナリ名称：BOOT_AUTH_STATUS）
        createTime:
          type: string
          description: 作成時間（フォーマット：YYYY-MM-DD HH:mm:ss）
        updateTime:
          type: string
          description: 更新時間（フォーマット：YYYY-MM-DD HH:mm:ss）
        updater:
          type: string
          description: 更新者

    # 非抜取り点検
    NonSamplingCheck:
      type: object
      description: 非抜取り点検表示データ（前端画面表示用）
      properties:
        nonSamplingId:
          type: string
          description: 非抜取り点検番号
        reportId:
          type: string
          description: レポート番号
        privateMobileDevStatus:
          type: string
          description: 個人モバイル機器状況（ディクショナリ名称：EXIST_STATUS）
        unrecordedWifiStatus:
          type: string
          description: 未登録WiFi状況（ディクショナリ名称：EXIST_STATUS）
        floorAccessClosedStatus:
          type: string
          description: フロア入退管理状況（ディクショナリ名称：CONFIRM_STATUS）
        publicMobileDevOutStatus:
          type: string
          description: 共有モバイル機器持出し状況（ディクショナリ名称：EXIST_STATUS）
        icCardWornStatus:
          type: string
          description: ICカード着用状況（ディクショナリ名称：CONFIRM_STATUS）
        copierNoDocStatus:
          type: string
          description: コピー機文書遺留状況（ディクショナリ名称：CONFIRM_STATUS）
        printerNoDocStatus:
          type: string
          description: プリンタ文書遺留状況（ディクショナリ名称：CONFIRM_STATUS）
        noIdleDeviceStatus:
          type: string
          description: 未使用機器状況（ディクショナリ名称：CONFIRM_STATUS）
        deskNoDocStatus:
          type: string
          description: 机上文書遺留状況（ディクショナリ名称：CONFIRM_STATUS）
        disposalMeasures:
          type: string
          description: 処置措置
        createTime:
          type: string
          description: 作成時間（フォーマット：YYYY-MM-DD HH:mm:ss）
        updateTime:
          type: string
          description: 更新時間（フォーマット：YYYY-MM-DD HH:mm:ss）
        updater:
          type: string
          description: 更新者

    # 月次点検レポート
    MonthlyCheckReport:
      type: object
      description: 月次点検レポート表示データ（前端画面表示用）
      properties:
        reportId:
          type: string
          description: レポート番号
        updateDate:
          type: string
          description: 更新日付（フォーマット：YYYY-MM-DD）
        securityPromoter:
          type: string
          description: 情報セキュリティ推進者
        securityResponsible:
          type: string
          description: 情報セキュリティ責任者
        qualityDept:
          type: string
          description: 品質管理部
        checkRemark:
          type: string
          description: 点検備考
        checkDescription:
          type: string
          description: 点検説明
        workArea:
          type: string
          description: 作業区域
        deptName:
          type: string
          description: 部署名（部署マスタに関連）
        samplingCheckCount:
          type: integer
          description: 抜取り点検件数
        nonSamplingCheckCount:
          type: integer
          description: 非抜取り点検件数
        passRate:
          type: string
          description: 合格割合（フォーマット：xx.x%）
        createTime:
          type: string
          description: 作成時間（フォーマット：YYYY-MM-DD HH:mm:ss）
        updateTime:
          type: string
          description: 更新時間（フォーマット：YYYY-MM-DD HH:mm:ss）
        updater:
          type: string
          description: 更新者

          
paths:
  # リスト照会
  /device-permission/query:
    get:  # GETはrequestBodyをサポートしないためPOSTに修正
      tags:
        - 権限リスト
      summary: デバイス権限リスト照会
      parameters:
        - name: pageNum
          in: query
          description: ページ番号
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: pageSize
          in: query
          description: 1ページあたりの表示件数
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      requestBody:
        required: false
        content:
          application/json:
            schema:
              properties:
                userInfo:
                  $ref: '#/components/schemas/UserInfo'
                deviceInfo:
                  $ref: '#/components/schemas/DeviceInfo'
                deviceIp:
                  $ref: '#/components/schemas/DeviceIp'
                devicePermission:
                  $ref: '#/components/schemas/DevicePermission'
      responses:
        '200':
          description: クエリに成功しました
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PageResponse'

  # データ変更
  /device-permission/update:
    put:
      tags:
        - 権限リスト
      summary: デバイス権限の変更
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                deviceInfo:
                  $ref: '#/components/schemas/DeviceInfo'
                deviceIp:
                  $ref: '#/components/schemas/DeviceIp'
                devicePermission:
                  $ref: '#/components/schemas/DevicePermission'
                userInfo:
                  $ref: '#/components/schemas/UserInfo'
      responses:
        '200':
          description: 変更成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DevicePermission'

  # データエクスポート（xlsx形式）
  /device-permission/export:
    post:  # GETはrequestBodyをサポートしないためPOSTに修正
      tags:
        - 権限リスト
      summary: デバイス権限リストのエクスポート
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                deviceInfo:
                  $ref: '#/components/schemas/DeviceInfo'
                deviceIp:
                  $ref: '#/components/schemas/DeviceIp'
                devicePermission:
                  $ref: '#/components/schemas/DevicePermission'
                userInfo:
                  $ref: '#/components/schemas/UserInfo'
      responses:
        '200':
          description: エクスポート成功
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary

  #获取字典/ディクショナリ
  /common/dictionary:
    get:  
      tags:
        - 共通
      summary: 共通項目の取得
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  dictType:
                    type: array
                    items:
                      allOf:
                      - $ref: '#/components/schemas/dictType'
                      - type: object  # 新增dictItem字段
                      properties:
                        dictItem:
                          type: array
                          items:
                            $ref: '#/components/schemas/dictItem'
                
                  
  #登录/トークン取得
  /user/login:
    post:
      tags:
        - ユーザー 
      summary: ユーザーのログイン
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                loginName:
                  type: string
                  description: ログイン名
                password:
                  type: string
                  description: パスワード
      responses:
        '200':
          description: ログイン成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/UserInfo'
                          - type: object  # 新增token字段
                            properties:
                              token:
                                type: string  
                              expireDate:
                                type: string
                                format: date-time

  #登出/トークン失効
  /user/logout:
    post:
      tags:
        - ユーザー 
      summary: ユーザーのログアウト
      responses:
        '200':
          description: ログアウト成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        type: string
                        description: 通知メッセージ
                        example: ログアウト成功
  #ユーザーパスワード情報更新
  /user/passwordUpdate:
    put:
      tags:
        - ユーザー  
      summary: ユーザーのパスワード情報更新
      requestBody:
        required: true 
        content:
          application/json:
            schema:
              properties:
                oldPassword:
                  type: string
                  description: 旧パスワード
                newPassword:
                  type: string
                  description: 新パスワード
      responses:
        '200':
          description: パスワード更新成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        type: string
                        description: 通知メッセージ
                        example: パスワード更新成功

  #密码重置/パスワードりセット
  /user/passwordReset: 
    post:
      tags:
        - ユーザー  
      summary: パスワードリセット
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                loginName:
                  type: string
                  description: ログイン名
                email:
                  type: string
                  description: メールアドレス
      responses:
        '200':
          description: パスワードリセットメール送信成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        type: string
                        description: 通知メッセージ
                        example: パスワードリセットメール送信成功

  #用户权限设置/ユーザー権限設定
  /user/permission:
    put:
      tags:
        - ユーザー  
      summary: ユーザーの権限設定
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                userId:
                  type: string
                  description: ユーザーID
                roleId:
                  type: string
                  description: アクセスレベル
      responses:
        '200':
          description: 権限設定成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        type: string
                        description: 通知メッセージ
                        example: 権限設定成功

  #用户导入/ユーザーインポート
  /user/import:
    post:
      tags:
        - ユーザー
      summary: ユーザーのインポート
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              properties:
                file:
                  type: string
                  format: binary
                  description: インポートファイル
      responses:
        '200':
          description: インポート成功
          content:  
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        type: string
                        description: 通知メッセージ
                        example: インポート成功

  #设备资产导入/資産インポート
  /device/import:
    post:
      tags:
        - 資産
      summary: 資産のインポート
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              properties:
                file:
                  type: string
                  format: binary
                  description: インポートファイル
      responses:
        '200':
          description: インポート成功
          content:  
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        type: string
                        description: 通知メッセージ
                        example: インポート成功

  #抽检查询/抽検照会
  /inspection/query:
    get:
      tags:
        - 抽検
      summary: 抜き取り検査の照会
      requestBody:
        required: false
        content:
          application/json:
            schema:
              properties:
                deviceInfo:
                  $ref: '#/components/schemas/DeviceInfo'
                deviceIp:
                  $ref: '#/components/schemas/DeviceIp'
                devicePermission:
                  $ref: '#/components/schemas/DevicePermission'
                userInfo:
                  $ref: '#/components/schemas/UserInfo'
                startTime:
                  type: string
                  format: date-time
                  description: 開始日時
                endTime:
                  type: string
                  format: date-time
                  description: 終了日時
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          samplingCheckList:
                            type: array
                            items:
                              $ref: '#/components/schemas/SamplingCheck'
                          nonSamplingChecklist:
                            type: array
                            items: 
                              $ref: '#/components/schemas/NonSamplingCheck'
                          monthlyCheckReport:
                            type: object
                            items: 
                              $ref: '#/components/schemas/MonthlyCheckReport'

  #新增抽检/抽検追加
  /inspection/add:
    post:
      tags:
        - 抽検
      summary: 抜き取り検査の追加
      requestBody:
        required: false
        content:
          application/json:
            schema:
              properties:
                deviceInfo:
                  $ref: '#/components/schemas/DeviceInfo'
                deviceIp:
                  $ref: '#/components/schemas/DeviceIp'
                devicePermission:
                  $ref: '#/components/schemas/DevicePermission'
                userInfo:
                  $ref: '#/components/schemas/UserInfo'
                samplingCheck:
                  $ref: '#/components/schemas/SamplingCheck'
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        type: string
                        description: 通知メッセージ
                        example: 抽検追加成功

