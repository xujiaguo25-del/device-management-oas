# OpenAPI 3.0 仕様 - デバイス管理コアAPI
openapi: 3.0.3
info:
  title: デバイス管理システムコアAPI
  description: デバイス情報管理、IP管理、ステータス管理、操作管理の4大コア機能に基づくOAS仕様定義
  version: 1.0.0
servers:
  - url: http://localhost:8080/api/v1/device
    description: ローカル開発環境サーバー
paths:
  # 一、デバイス情報管理 API
  /basic:
    # デバイス情報新規登録
    post:
      summary: 単体デバイス基本ファイルの新規登録
      description: 手動でデバイスのコア情報を入力し、デジタルアーカイブを完成させ、デバイス番号はユニークで重複不可
      tags:
        - デバイス情報管理
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - deviceNo
                - deviceName
                - model
                - brand
                - purchaseDate
                - dept
              properties:
                deviceNo:
                  type: string
                  description: デバイス番号（ユニーク識別子）
                  example: DEV001
                deviceName:
                  type: string
                  description: デバイス名
                  example: オフィスノートパソコン
                model:
                  type: string
                  description: デバイスモデル
                  example: ThinkPad X1 Carbon
                brand:
                  type: string
                  description: デバイスブランド
                  example: レノボ
                purchaseDate:
                  type: string
                  format: date
                  description: 購入日（フォーマット：yyyy-MM-dd）
                  example: 2025-01-15
                dept:
                  type: string
                  description: 所属部署
                  example: 技術部
                user:
                  type: string
                  description: 使用担当者
                  example: 張三
                location:
                  type: string
                  description: 設置場所
                  example: DA04オフィス
                remark:
                  type: string
                  description: 備考情報
                  example: バックエンド開発業務用
      responses:
        '200':
          description: 新規登録成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: デバイス新規登録成功
                data:
                  deviceNo: DEV001
                timestamp: 1735689600000
        '400':
          description: パラメータエラー（デバイス番号重複/必須項目不足）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 400
                message: デバイス番号DEV001は既に存在します
                data: null
                timestamp: 1735689600000
  /basic/{deviceNo}:
    parameters:
      - name: deviceNo
        in: path
        required: true
        description: デバイス番号
        schema:
          type: string
          example: DEV001
    # デバイス情報精密クエリ
    get:
      summary: デバイス番号に基づくデバイス完全ファイルの精密クエリ
      description: ユニークなデバイス番号に基づき、デバイスのすべての基本情報をクエリ
      tags:
        - デバイス情報管理
      responses:
        '200':
          description: クエリ成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: クエリ成功
                data:
                  deviceNo: DEV001
                  deviceName: オフィスノートパソコン
                  model: ThinkPad X1 Carbon
                  brand: DELL
                  purchaseDate: 2025-01-15
                  dept: モバイルアプリ開発部
                  user: 張三
                  location: DA04オフィス
                  remark: バックエンド開発業務用
                timestamp: 1735689600000
        '404':
          description: デバイス不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 404
                message: デバイス番号DEV001は存在しません
                data: null
                timestamp: 1735689600000
    # デバイス情報修正
    put:
      summary: デバイス番号に基づくデバイス基本情報の修正
      description: ユニークでないフィールド（使用担当者、設置場所など）のみ修正可能、デバイス番号は修正不可
      tags:
        - デバイス情報管理
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                deviceName:
                  type: string
                  description: デバイス名
                  example: オフィスノートパソコン（更新後）
                user:
                  type: string
                  description: 使用担当者
                  example: 李四
                location:
                  type: string
                  description: 設置場所
                  example: DA04オフィス
                remark:
                  type: string
                  description: 備考情報
                  example: フロントエンド開発業務用
      responses:
        '200':
          description: 修正成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: デバイス情報修正成功
                data:
                  affectedRows: 1
                timestamp: 1735689600000
        '404':
          description: デバイス不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 404
                message: デバイス番号DEV001は存在しません
                data: null
                timestamp: 1735689600000
    # デバイス情報削除
    delete:
      summary: デバイス番号に基づくデバイスファイルの削除（ソフトデリート）
      description: デフォルトはソフトデリート（無効標識）、isForceパラメータを渡すことでフィジカルデリートをサポート
      tags:
        - デバイス情報管理
      parameters:
        - name: isForce
          in: query
          required: false
          description: フィジカルデリートかどうか（デフォルトfalse：ソフトデリート；true：フィジカルデリート）
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: 削除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: デバイス削除成功
                data:
                  deviceNo: DEV001
                  status: 廃棄済み（ソフトデリート）
                timestamp: 1735689600000
        '404':
          description: デバイス不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 404
                message: デバイス番号DEV001は存在しません
                data: null
                timestamp: 1735689600000
  /basic/list:
    # デバイスリストのあいまいクエリ
    get:
      summary: マルチコンディションによるデバイスのあいまいクエリ、ページングをサポート
      description: デバイス名、モデル、部署などの条件によるあいまいクエリ、ページング結果を返却
      tags:
        - デバイス情報管理
      parameters:
        - name: pageNum
          in: query
          required: true
          description: 現在ページ番号
          schema:
            type: integer
            default: 1
            example: 1
        - name: pageSize
          in: query
          required: true
          description: 1ページあたりのデータ件数
          schema:
            type: integer
            default: 10
            example: 10
        - name: deviceName
          in: query
          required: false
          description: デバイス名（あいまいクエリ）
          schema:
            type: string
            example: ノートパソコン
        - name: model
          in: query
          required: false
          description: デバイスモデル（あいまいクエリ）
          schema:
            type: string
            example: X1
        - name: dept
          in: query
          required: false
          description: 所属部署
          schema:
            type: string
            example: 技術部
        - name: user
          in: query
          required: false
          description: 使用担当者
          schema:
            type: string
            example: 張三
      responses:
        '200':
          description: クエリ成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: クエリ成功
                data:
                  total: 20
                  pages: 2
                  currentPage: 1
                  pageSize: 10
                  list:
                    - deviceNo: DEV001
                      deviceName: オフィスノートパソコン
                      model: ThinkPad X1 Carbon
                      brand: DELL
                      dept: 技術部
                      user: 張三
                    - deviceNo: DEV002
                      deviceName: オフィスデスクトップパソコン
                      model: ThinkCentre M900
                      brand: レノボ
                      dept: 技術部
                      user: 李四
                timestamp: 1735689600000

  # 二、デバイスIP管理 API
  /ip/bind:
    # デバイスIPバインド
    post:
      summary: デバイスに固定IPアドレスをバインド
      description: IPユニーク性を自動検証、IPコンフリクトを回避、単一デバイスのマルチIPバインドをサポート
      tags:
        - デバイスIP管理
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - deviceNo
                - ipAddr
                - ipType
                - assignDate
              properties:
                deviceNo:
                  type: string
                  description: デバイス番号
                  example: DEV001
                ipAddr:
                  type: string
                  description: IPアドレス
                  example: 192.168.1.101
                subnetMask:
                  type: string
                  description: サブネットマスク
                  example: 255.255.255.0
                gateway:
                  type: string
                  description: ゲートウェイ
                  example: 192.168.1.1
                ipType:
                  type: string
                  description: IPタイプ（イントラネット/エクストラネット）
                  enum: [イントラネット, エクストラネット]
                  example: イントラネット
                assignDate:
                  type: string
                  format: date
                  description: 割り当て日
                  example: 2025-01-16
                validPeriod:
                  type: string
                  description: 有効期間（例：永久/2026-01-16）
                  example: 永久
      responses:
        '200':
          description: バインド成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: IPバインド成功
                data:
                  ipRecordId: 1
                timestamp: 1735689600000
        '400':
          description: IPは既にバインド済み
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 400
                message: IPアドレス192.168.1.101は他のデバイスに既にバインド済み
                data: null
                timestamp: 1735689600000
  /ip/unbind/{ipRecordId}:
    # デバイスIPアンバインド
    delete:
      summary: デバイスとIPのバインド関係を解除
      description: IPアドレスを解放し、他のデバイスが再割り当てできるようにする
      tags:
        - デバイスIP管理
      parameters:
        - name: ipRecordId
          in: path
          required: true
          description: IPバインドレコードユニークID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: アンバインド成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: IPアンバインド成功
                data:
                  ipAddr: 192.168.1.101
                timestamp: 1735689600000
        '404':
          description: IPバインドレコード不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 404
                message: IPバインドレコードID1は存在しません
                data: null
                timestamp: 1735689600000
  /ip/device/{deviceNo}:
    # デバイスに基づくIPクエリ
    get:
      summary: 指定デバイスにバインドされたすべてのIP情報をクエリ
      description: 単一デバイスのマルチIPシナリオをサポート、該当デバイスのすべてのIPバインドレコードを返却
      tags:
        - デバイスIP管理
      parameters:
        - name: deviceNo
          in: path
          required: true
          description: デバイス番号
          schema:
            type: string
            example: DEV001
      responses:
        '200':
          description: クエリ成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: クエリ成功
                data:
                  - ipRecordId: 1
                    ipAddr: 192.168.1.101
                    ipType: イントラネット
                    assignDate: 2025-01-16
                    validPeriod: 永久
                timestamp: 1735689600000
        '404':
          description: デバイスにバインドされたIP不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 404
                message: デバイスDEV001にはバインドされたIPがありません
                data: null
                timestamp: 1735689600000
  /ip/address/{ipAddr}:
    # IPに基づくデバイスクエリ
    get:
      summary: 指定IPに対応するデバイス情報をリバースクエリ
      description: IPコンフリクトのトラブルシューティングに使用、IPの所属デバイスをクイックロケート
      tags:
        - デバイスIP管理
      parameters:
        - name: ipAddr
          in: path
          required: true
          description: IPアドレス
          schema:
            type: string
            example: 192.168.1.101
      responses:
        '200':
          description: クエリ成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: クエリ成功
                data:
                  deviceNo: DEV001
                  deviceName: オフィスノートパソコン
                  model: ThinkPad X1 Carbon
                timestamp: 1735689600000
        '404':
          description: IPにバインドされたデバイス不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 404
                message: IPアドレス192.168.1.101にはバインドされたデバイスがありません
                data: null
                timestamp: 1735689600000

  # 三、デバイスステータス管理 API
  /status/switch/{deviceNo}:
    # デバイスステータス切り替え
    put:
      summary: 手動でデバイスステータスを切り替え、変更理由を記録
      description: デバイスライフサイクルのステータスフローをサポート（未使用→使用中→故障→修理中→修復済み→廃棄）
      tags:
        - デバイスステータス管理
      parameters:
        - name: deviceNo
          in: path
          required: true
          description: デバイス番号
          schema:
            type: string
            example: DEV001
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - targetStatus
                - changeReason
                - changer
              properties:
                targetStatus:
                  type: string
                  description: 目標ステータス
                  enum: [未使用, 使用中, 故障, 修理中, 修復済み, 廃棄]
                  example: 故障
                changeReason:
                  type: string
                  description: ステータス変更理由
                  example: バッテリー膨張、正常に起動できない
                changer:
                  type: string
                  description: 変更担当者
                  example: 張三
      responses:
        '200':
          description: ステータス切り替え成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: デバイスステータス切り替え成功
                data:
                  deviceNo: DEV001
                  oldStatus: 使用中
                  newStatus: 故障
                  changeTime: 2025-12-30 10:00:00
                timestamp: 1735689600000
        '404':
          description: デバイス不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 404
                message: デバイス番号DEV001は存在しません
                data: null
                timestamp: 1735689600000
  /status/list:
    # ステータスに基づくデバイスクエリ
    get:
      summary: デバイスステータスに基づくバッチクエリ、ページングをサポート
      description: 指定ステータスのデバイス数とリストを統計、デバイス管理に便利
      tags:
        - デバイスステータス管理
      parameters:
        - name: deviceStatus
          in: query
          required: true
          description: デバイスステータス
          schema:
            type: string
            enum: [未使用, 使用中, 故障, 修理中, 修復済み, 廃棄]
            example: 故障
        - name: pageNum
          in: query
          required: true
          description: 現在ページ番号
          schema:
            type: integer
            default: 1
            example: 1
        - name: pageSize
          in: query
          required: true
          description: 1ページあたりのデータ件数
          schema:
            type: integer
            default: 10
            example: 10
      responses:
        '200':
          description: クエリ成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: クエリ成功
                data:
                  total: 2
                  pages: 1
                  currentPage: 1
                  pageSize: 10
                  list:
                    - deviceNo: DEV001
                      deviceName: オフィスノートパソコン
                      model: ThinkPad X1 Carbon
                      status: 故障
                      changer: 張三
                    - deviceNo: DEV003
                      deviceName: プリンター
                      model: HP M404n
                      status: 故障
                      changer: 李四
                timestamp: 1735689600000
  /status/history/{deviceNo}:
    # デバイスステータス履歴クエリ
    get:
      summary: 指定デバイスのすべてのステータス変更レコードをクエリ
      description: デバイスステータスフロープロセスをトレース、故障分析と責任定義に便利
      tags:
        - デバイスステータス管理
      parameters:
        - name: deviceNo
          in: path
          required: true
          description: デバイス番号
          schema:
            type: string
            example: DEV001
      responses:
        '200':
          description: クエリ成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: クエリ成功
                data:
                  - oldStatus: 未使用
                    newStatus: 使用中
                    changeReason: 張三に業務用に割り当て
                    changer: 管理者
                    changeTime: 2025-01-16 09:00:00
                  - oldStatus: 使用中
                    newStatus: 故障
                    changeReason: バッテリー膨張、正常に起動できない
                    changer: 張三
                    changeTime: 2025-12-30 10:00:00
                timestamp: 1735689600000

  # 四、デバイス操作管理 API
  /operation/log/list:
    # デバイス操作ログクエリ
    get:
      summary: マルチコンディションによるデバイス操作ログクエリ、ページングをサポート
      description: すべてのデバイス関連操作をトレース、監査とトラブルシューティングに便利
      tags:
        - デバイス操作管理
      parameters:
        - name: operator
          in: query
          required: false
          description: 操作担当者
          schema:
            type: string
            example: 張三
        - name: operationType
          in: query
          required: false
          description: 操作タイプ
          schema:
            type: string
            enum: [新規登録, 修正, 削除, IPバインド, IPアンバインド, ステータス切り替え]
            example: ステータス切り替え
        - name: deviceNo
          in: query
          required: false
          description: デバイス番号
          schema:
            type: string
            example: DEV001
        - name: startTime
          in: query
          required: false
          description: 操作開始時間（フォーマット：yyyy-MM-dd HH:mm:ss）
          schema:
            type: string
            example: 2025-12-01 00:00:00
        - name: endTime
          in: query
          required: false
          description: 操作終了時間（フォーマット：yyyy-MM-dd HH:mm:ss）
          schema:
            type: string
            example: 2025-12-30 23:59:59
        - name: pageNum
          in: query
          required: true
          description: 現在ページ番号
          schema:
            type: integer
            default: 1
            example: 1
        - name: pageSize
          in: query
          required: true
          description: 1ページあたりのデータ件数
          schema:
            type: integer
            default: 10
            example: 10
      responses:
        '200':
          description: クエリ成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommonResponse'
              example:
                code: 200
                message: クエリ成功
                data:
                  total: 1
                  pages: 1
                  currentPage: 1
                  pageSize: 10
                  list:
                    - operator: 張三
                      operationType: ステータス切り替え
                      deviceNo: DEV001
                      operationContent: デバイスステータスを「使用中」から「故障」に切り替え、理由：バッテリー膨張、正常に起動できない
                      operationTime: 2025-12-30 10:00:00
                timestamp: 1735689600000
  /operation/log/export:
    # デバイス操作ログエクスポート
    get:
      summary: 指定条件のデバイス操作ログをエクスポート（Excelフォーマット）
      description: 操作ログをアーカイブして保存、オフライン閲覧と監査をサポート
      tags:
        - デバイス操作管理
      parameters:
        - name: startTime
          in: query
          required: false
          description: 操作開始時間（フォーマット：yyyy-MM-dd HH:mm:ss）
          schema:
            type: string
            example: 2025-12-01 00:00:00
        - name: endTime
          in: query
          required: false
          description: 操作終了時間（フォーマット：yyyy-MM-dd HH:mm:ss）
          schema:
            type: string
            example: 2025-12-30 23:59:59
        - name: operationType
          in: query
          required: false
          description: 操作タイプ
          schema:
            type: string
            enum: [新規登録, 修正, 削除, IPバインド, IPアンバインド, ステータス切り替え]
            example: ステータス切り替え
      responses:
        '200':
          description: エクスポート成功、ファイルストリームを返却
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
components:
  # 統一レスポンスボディ Schema
  schemas:
    CommonResponse:
      type: object
      properties:
        code:
          type: integer
          description: ステータスコード（200成功、400パラメータエラー、401未認証、404リソース不存在、500サーバー異常）
          example: 200
        message:
          type: string
          description: 提示情報
          example: 操作成功
        data:
          type: object
          description: 業務データ（データなしの場合はnull）
          nullable: true
        timestamp:
          type: integer
          description: タイムスタンプ（ミリ秒単位）
          example: 1735689600000