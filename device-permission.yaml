openapi: 3.0.0
info:
  title: DA04部門設備管理システム API
  description: DA04部門内機器管理システムのOpenAPI仕様
  version: 1.1.0
  contact:
    name: 設備管理APIサポート
    email: equip-support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.example.com/v1
    description: 本番サーバー
  - url: https://staging-api.example.com/v1
    description: ステージングサーバー

components:
  schemas:
    CommonResponse:
      type: object
      properties:
        code:
          type: integer
          description: 状态码：200成功，其他为错误
          example: 200
        message:
          type: string
          description: 提示信息
          example: 操作成功
        data:
          type: object
          description: 业务数据（成功时返回）
        error:
          type: object
          properties:
            field:
              type: string
              description: 错误字段
              example: pageNum
            msg:
              type: string
              description: 错误详情
              example: 页码必须为正整数
    DeviceBasicInfo:
      type: object
      properties:
        deviceNo:
          type: string
          description: 设备编号
          example: HYRON-220914 PC-DC-049
        computerName:
          type: string
          description: 电脑名
          example: DA04-liuwenfeng
        ipAddress:
          type: string
          description: IP地址（多个用逗号分隔）
          example: 10.6.1.99,10.6.3.221
        dept:
          type: string
          description: 所属部门
          example: DA04
    EmployeeInfo:
      type: object
      properties:
        employeeId:
          type: string
          description: 工号
          example: JS0020
        employeeName:
          type: string
          description: 姓名
          example: 刘文丰
        level:
          type: string
          description: 权限级别
          example: DA04
        loginName:
          type: string
          description: 登录用户名
          example: lfeng
    DomainConfig:
      type: object
      properties:
        domainName:
          type: string
          description: 域名
          example: MS
        domainGroupName:
          type: string
          description: 域内组名
          example: DA04-Admin
        noDomainReason:
          type: string
          description: 不加域理由
          example: 测试专用设备
    PermissionConfig:
      type: object
      properties:
        usbStatus:
          type: string
          description: USB状态
          enum:
            - 开启
            - 关闭
          example: 关闭
        usbReason:
          type: string
          description: USB开通理由
          example: 项目需要
        smartitStatus:
          type: string
          description: SmartIT状态
          enum:
            - 本地
            - 未安装
          example: 本地
        noSmartitReason:
          type: string
          description: 不安装SmartIT理由
          example: 设备不支持
        expireDate:
          type: string
          format: date
          description: 使用截止日期
          example: '2025-12-31'
    SecurityConfig:
      type: object
      properties:
        antivirusStatus:
          type: string
          description: 防病毒状态
          enum:
            - 自动
            - 手动
            - 未配置
          example: 自动
        noSymantecReason:
          type: string
          description: 无Symantec理由
          example: 使用第三方防病毒软件
    DevicePermissionDetail:
      allOf:
        - $ref: '#/components/schemas/DeviceBasicInfo'
        - type: object
          properties:
            employeeInfo:
              $ref: '#/components/schemas/EmployeeInfo'
            domainConfig:
              $ref: '#/components/schemas/DomainConfig'
            permissionConfig:
              $ref: '#/components/schemas/PermissionConfig'
            securityConfig:
              $ref: '#/components/schemas/SecurityConfig'
            remark:
              type: string
              description: 备注
              example: 考勤系统服务器
    PageResponse:
      type: object
      properties:
        total:
          type: integer
          description: 总记录数
          example: 155
        pages:
          type: integer
          description: 总页数
          example: 8
        pageNum:
          type: integer
          description: 当前页码
          example: 1
        pageSize:
          type: integer
          description: 每页条数
          example: 20
        list:
          type: array
          items:
            $ref: '#/components/schemas/DevicePermissionDetail'
    StatisticsData:
      type: object
      properties:
        deptDistribution:
          type: object
          description: 部门设备分布
          example:
            DA04: 120
            DA02: 30
            DA05: 5
        usbStatusDistribution:
          type: object
          description: USB状态分布
          example:
            关闭: 135
            开启: 0
            未配置: 20
        smartitDistribution:
          type: object
          description: SmartIT状态分布
          example:
            本地: 151
            未安装: 4
        expireCount:
          type: object
          description: 有效期统计
          example:
            未过期: 139
            已过期: 0
            即将过期（30天内）: 16
  parameters:
    PageParam:
      in: query
      name: pageParam
      schema:
        type: object
        properties:
          pageNum:
            type: integer
            default: 1
            description: 页码
          pageSize:
            type: integer
            default: 10
            description: 每页条数
    DeviceQueryParam:
      in: query
      name: deviceQueryParam
      schema:
        type: object
        properties:
          dept:
            type: string
            description: 部门编码
          deviceStatus:
            type: string
            enum:
              - 正常
              - 停用
            description: 设备状态
          employeeId:
            type: string
            description: 责任人工号
          expireStatus:
            type: string
            enum:
              - 未过期
              - 已过期
              - 即将过期
            description: 有效期状态
    DeviceIdParam:
      in: query
      name: deviceIdParam
      schema:
        type: object
        properties:
          deviceNo:
            type: string
            description: 设备编号（三选一）
          computerName:
            type: string
            description: 电脑名（三选一）
          ipAddress:
            type: string
            description: IP地址（三选一）
    EmployeeIdParam:
      in: query
      name: employeeIdParam
      schema:
        type: object
        properties:
          employeeId:
            type: string
            description: 工号（三选一）
          employeeName:
            type: string
            description: 姓名（三选一）
          loginName:
            type: string
            description: 登录用户名（三选一）
  responses:
    SuccessResponse:
      description: 操作成功
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CommonResponse'
          example:
            code: 200
            message: 操作成功
            data: {}
            error: null
    BadRequestResponse:
      description: 参数错误
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CommonResponse'
          example:
            code: 400
            message: 参数错误
            data: null
            error:
              field: pageNum
              msg: 页码必须为正整数
    NotFoundResponse:
      description: 资源不存在
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CommonResponse'
          example:
            code: 404
            message: 设备不存在
            data: null
            error:
              field: deviceNo
              msg: 未找到编号为HYRON-9999的设备
    ServerErrorResponse:
      description: 服务器内部错误
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CommonResponse'
          example:
            code: 500
            message: 服务器内部错误
            data: null
            error:
              msg: 数据库连接异常，请稍后重试


paths:
#
  /device-permission/query/list:
    get:
      summary: 设备权限列表查询
      description: 获取设备权限清单，支持分页、排序和多维度筛选
      parameters:
        - in: query
          name: pageNum
          schema:
            type: integer
            default: 1
          required: false
          description: 页码
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 10
          required: false
          description: 每页条数
        - in: query
          name: dept
          schema:
            type: string
          required: false
          description: 部门编码
        - in: query
          name: deviceStatus
          schema:
            type: string
            enum:
              - 正常
              - 停用
          required: false
          description: 设备状态
        - in: query
          name: employeeId
          schema:
            type: string
          required: false
          description: 责任人工号
        - in: query
          name: expireStatus
          schema:
            type: string
            enum:
              - 未过期
              - 已过期
              - 即将过期
          required: false
          description: 有效期状态
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PageResponse'
              example:
                code: 200
                message: 查询成功
                data:
                  total: 155
                  pages: 8
                  pageNum: 1
                  pageSize: 20
                  list:
                    - deviceNo: HYRON-220914 PC-DC-049
                      computerName: DA04-liuwenfeng
                      ipAddress: 10.6.1.99,10.6.3.221
                      dept: DA04
                      employeeInfo:
                        employeeId: JS0020
                        employeeName: 刘文丰
                        level: DA04
                        loginName: lfeng
                      domainConfig:
                        domainName: ''
                        domainGroupName: ''
                        noDomainReason: ''
                      permissionConfig:
                        usbStatus: 关闭
                        usbReason: ''
                        smartitStatus: 本地
                        noSmartitReason: ''
                        expireDate: '2025-12-31'
                      securityConfig:
                        antivirusStatus: 自动
                        noSymantecReason: ''
                      remark: ''
                error: null
  /device-permission/query/detail:
    get:
      summary: 单设备权限详情查询
      description: 查询单个设备的完整权限配置信息（设备编号/电脑名/IP地址三选一）
      parameters:
        - in: query
          name: deviceNo
          schema:
            type: string
          required: false
          description: 设备编号
        - in: query
          name: computerName
          schema:
            type: string
          required: false
          description: 电脑名
        - in: query
          name: ipAddress
          schema:
            type: string
          required: false
          description: IP地址
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CommonResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DevicePermissionDetail'
              example:
                code: 200
                message: 查询成功
                data:
                  deviceNo: HYRON-220914 PC-DC-049
                  computerName: DA04-liuwenfeng
                  ipAddress: 10.6.1.99,10.6.3.221
                  dept: DA04
                  employeeInfo:
                    employeeId: JS0020
                    employeeName: 刘文丰
                    level: DA04
                    loginName: lfeng
                  domainConfig:
                    domainName: ''
                    domainGroupName: ''
                    noDomainReason: ''
                  permissionConfig:
                    usbStatus: 关闭
                    usbReason: ''
                    smartitStatus: 本地
                    noSmartitReason: ''
                    expireDate: '2025-12-31'
                  securityConfig:
                    antivirusStatus: 自动
                    noSymantecReason: ''
                  remark: ''
                error: null
        '400':
          $ref: '#/components/responses/BadRequestResponse'
        '404':
          $ref: '#/components/responses/NotFoundResponse'
        '500':
          $ref: '#/components/responses/ServerErrorResponse'
  /device-permission/control/usb-toggle:
    post:
      summary: USB权限开关控制
      description: 开启或关闭设备的USB端口权限，支持临时开通（需设置有效期）
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - deviceNo
                - action
              properties:
                deviceNo:
                  type: string
                  description: 设备编号
                  example: HYRON-220914 PC-DC-049
                action:
                  type: string
                  enum:
                    - enable
                    - disable
                  description: 操作类型（enable=开启，disable=关闭）
                  example: enable
                reason:
                  type: string
                  description: 操作理由（开启时必填）
                  example: 项目数据传输需要
                expireDate:
                  type: string
                  format: date
                  description: 有效期（开启时必填，格式YYYY-MM-DD）
                  example: '2025-12-31'
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequestResponse'
        '404':
          $ref: '#/components/responses/NotFoundResponse'
        '500':
          $ref: '#/components/responses/ServerErrorResponse'
  /device-permission/create/single:
    post:
      summary: 设备权限记录创建
      description: 新增单条设备权限记录，包含完整的设备信息和权限配置
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DevicePermissionDetail'
            example:
              deviceNo: HYRON-241201 PC-DC-060
              computerName: DA04-zhangshan
              ipAddress: 10.6.1.100
              dept: DA04
              employeeInfo:
                employeeId: JS0200
                employeeName: 张三
                level: DA04
                loginName: zhangs
              domainConfig:
                domainName: MS
                domainGroupName: DA04-User
                noDomainReason: ''
              permissionConfig:
                usbStatus: 关闭
                usbReason: ''
                smartitStatus: 本地
                noSmartitReason: ''
                expireDate: '2026-12-31'
              securityConfig:
                antivirusStatus: 自动
                noSymantecReason: ''
              remark: 新入职员工设备
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequestResponse'
        '500':
          $ref: '#/components/responses/ServerErrorResponse'
  /device-permission/update/permission-config:
    put:
      summary: 权限配置更新
      description: 修改设备的权限状态（如USB开关、域配置、SmartIT状态等）
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - deviceNo
              properties:
                deviceNo:
                  type: string
                  description: 设备编号
                  example: HYRON-220914 PC-DC-049
                domainConfig:
                  $ref: '#/components/schemas/DomainConfig'
                permissionConfig:
                  $ref: '#/components/schemas/PermissionConfig'
                securityConfig:
                  $ref: '#/components/schemas/SecurityConfig'
                modifyReason:
                  type: string
                  description: 修改理由
                  example: 权限调整需求
                operator:
                  type: string
                  description: 操作人
                  example: JS0001
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequestResponse'
        '404':
          $ref: '#/components/responses/NotFoundResponse'
        '500':
          $ref: '#/components/responses/ServerErrorResponse'